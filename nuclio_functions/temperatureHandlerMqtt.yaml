metadata:
  name: temperatureHandlerMqtt
  labels:
    nuclio.io/project-name: 259e10f4-56ab-4271-b8ff-a0209a7dec74
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-acaso:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    aCaso:
      class: ""
      kind: mqtt
      url: "guest:guest@192.168.1.7:1883"
      attributes:
        subscriptions:
          - qos: 2
            topic: iot/sensors/temperature
  build:
    image: ""
    noCache: false
    offline: false
    dependencies: []
    runtimeAttributes:
      repositories: []
    functionSourceCode: dmFyIG1xdHQgPSByZXF1aXJlKCdtcXR0Jyk7DQoNCmNvbnN0IEZVTkNUSU9OX05BTUUgPSAidGVtcGVyYXR1cmVIYW5kbGVyTXF0dCI7DQpjb25zdCBJUCA9ICIxOTIuMTY4LjEuNyINCmNvbnN0IENPTkRJVElPTkVSX1RPUElDID0gImlvdC9kZXZpY2VzL2NvbmRpdGlvbmVyIg0KY29uc3QgVEhFUk1PU1RBVF9UT1BJQyA9ICJpb3QvZGV2aWNlcy90aGVybW9zdGF0Ig0KY29uc3QgVEFCTEVUX1RPUElDID0gImlvdC9kZXZpY2VzL3RhYmxldCINCg0KY29uc3QgTUFYX1RFTVBFUkFUVVJFID0gMjYNCmNvbnN0IE1JTl9URU1QRVJBVFVSRSA9IDIyDQpjb25zdCBURU1QRVJBVFVSRV9MMSA9IDUNCmNvbnN0IFRFTVBFUkFUVVJFX0wyID0gMTENCmNvbnN0IFRFTVBFUkFUVVJFX0wzID0gMzQNCmNvbnN0IFRFTVBFUkFUVVJFX0w0ID0gNDANCg0KdmFyIG9wdGlvbnMgPSB7DQogICAgaG9zdDogJ21xdHQ6Ly8xOTIuMTY4LjEuNycsDQogICAgY2xpZW50SWQ6ICdtcXR0anNfJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnN1YnN0cigyLCA4KSwNCiAgICB1c2VybmFtZTogJ2d1ZXN0JywNCiAgICBwYXNzd29yZDogJ2d1ZXN0JywNCn07DQoNCnZhciBwb3dlciA9ICIwIg0KdmFyIGRlc2NyaXB0aW9uID0gIm5vIg0KdmFyIHRlbXBlcmF0dXJlID0gMjUNCg0KYXN5bmMgZnVuY3Rpb24gc2VuZF90b19vbmVfdG9waWNfbXF0dCh0b3BpYywgcG93ZXIsIHRlbXBlcmF0dXJlLCBkZXNjcmlwdGlvbikgew0KICAgIHZhciBjbGllbnQgPSBtcXR0LmNvbm5lY3QoIm1xdHQ6Ly8iICsgSVAsIG9wdGlvbnMpOw0KICAgIGNsaWVudC5vbignY29ubmVjdCcsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgY2xpZW50LnB1Ymxpc2godG9waWMsIHRlbXBlcmF0dXJlICsgIi0iICsgcG93ZXIgKyAiLSIgKyBkZXNjcmlwdGlvbiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgY2xpZW50LmVuZCgpOw0KICAgICAgICB9KTsNCiAgICB9KTsNCn0NCmFzeW5jIGZ1bmN0aW9uIHNlbmRfdG9fdHdvX3RvcGljX21xdHQodG9waWMxLCB0b3BpYzIsIHBvd2VyLCB0ZW1wZXJhdHVyZSwgZGVzY3JpcHRpb24pIHsNCiAgICB2YXIgY2xpZW50ID0gbXF0dC5jb25uZWN0KCJtcXR0Oi8vIiArIElQLCBvcHRpb25zKTsNCiAgICBjbGllbnQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIGNsaWVudC5wdWJsaXNoKHRvcGljMSwgdGVtcGVyYXR1cmUgKyAiLSIgKyBwb3dlciArICItIiArIGRlc2NyaXB0aW9uLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBjbGllbnQucHVibGlzaCh0b3BpYzIsIHRlbXBlcmF0dXJlICsgIi0iICsgcG93ZXIgKyAiLSIgKyBkZXNjcmlwdGlvbiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGNsaWVudC5lbmQoKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9KTsNCiAgICB9KTsNCn0NCmFzeW5jIGZ1bmN0aW9uIHNlbmRfdG9fdGhyZWVfdG9waWNfbXF0dCh0b3BpYzEsIHRvcGljMiwgdG9waWMzLCBwb3dlciwgdGVtcGVyYXR1cmUsIGRlc2NyaXB0aW9uKSB7DQogICAgdmFyIGNsaWVudCA9IG1xdHQuY29ubmVjdCgibXF0dDovLyIgKyBJUCwgb3B0aW9ucyk7DQogICAgY2xpZW50Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24gKCkgew0KICAgICAgICBjbGllbnQucHVibGlzaCh0b3BpYzEsIHRlbXBlcmF0dXJlICsgIi0iICsgcG93ZXIgKyAiLSIgKyBkZXNjcmlwdGlvbiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgY2xpZW50LnB1Ymxpc2godG9waWMyLCB0ZW1wZXJhdHVyZSArICItIiArIHBvd2VyICsgIi0iICsgZGVzY3JpcHRpb24sIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjbGllbnQucHVibGlzaCh0b3BpYzMsIHRlbXBlcmF0dXJlICsgIi0iICsgcG93ZXIgKyAiLSIgKyBkZXNjcmlwdGlvbiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICBjbGllbnQuZW5kKCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQoNCmZ1bmN0aW9uIGJpbjJzdHJpbmcoYXJyYXkpIHsNCiAgICB2YXIgcmVzdWx0ID0gIiI7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7ICsraSkgew0KICAgICAgICByZXN1bHQgKz0gKFN0cmluZy5mcm9tQ2hhckNvZGUoYXJyYXlbaV0pKTsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KZXhwb3J0cy5oYW5kbGVyID0gZnVuY3Rpb24gKGNvbnRleHQsIGV2ZW50KSB7DQogICAgdmFyIF9ldmVudCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsNCiAgICB2YXIgX2RhdGEgPSBiaW4yc3RyaW5nKF9ldmVudC5ib2R5LmRhdGEpOw0KDQogICAgdmFyIHRlbXBlcmF0dXJlID0gTnVtYmVyKF9kYXRhKQ0KICAgIGlmIChfZGF0YS50cmltKCkgPT0gIiIpIHRlbXBlcmF0dXJlID0gTUFYX1RFTVBFUkFUVVJFDQoNCiAgICB2YXIgcG93ZXIgPSAiMCINCiAgICB2YXIgZGVzY3JpcHRpb24gPSAibm8iDQoNCiAgICBpZiAodGVtcGVyYXR1cmUgPD0gTUFYX1RFTVBFUkFUVVJFICYmIHRlbXBlcmF0dXJlID49IE1JTl9URU1QRVJBVFVSRSkgew0KICAgICAgICAvLyBub24gZGV2byBmYXJlIG51bGxhLCBhbCBtYXNzaW1vIHN0b3BwbyB0dXR0bw0KICAgICAgICBwb3dlciA9ICIwIg0KICAgICAgICBkZXNjcmlwdGlvbiA9ICJzdG9wIg0KICAgICAgICBzZW5kX3RvX3RocmVlX3RvcGljX21xdHQoVEFCTEVUX1RPUElDLCBDT05ESVRJT05FUl9UT1BJQywgVEhFUk1PU1RBVF9UT1BJQywgcG93ZXIsIHRlbXBlcmF0dXJlLCBkZXNjcmlwdGlvbik7DQogICAgICAgIGNvbnRleHQuY2FsbGJhY2soImZlZWRiYWNrIHt0ZW1wZXJhdHVyZTogIiArIHRlbXBlcmF0dXJlICsgIiwgcG93ZXI6ICIgKyBwb3dlciArICIsIGRlc2NyaXB0aW9uOiAiICsgZGVzY3JpcHRpb24gKyAifSIpDQogICAgfQ0KICAgIGVsc2Ugew0KDQogICAgICAgIC8vIGRldm8gYWJiYXNzYXJlIGxhIHRlbXBlcmF0dXJhICAgIA0KICAgICAgICBpZiAodGVtcGVyYXR1cmUgPiBNQVhfVEVNUEVSQVRVUkUpIHsNCg0KICAgICAgICAgICAgaWYgKHRlbXBlcmF0dXJlIDwgVEVNUEVSQVRVUkVfTDMpDQogICAgICAgICAgICAgICAgcG93ZXIgPSAiMSI7DQogICAgICAgICAgICBlbHNlIGlmICh0ZW1wZXJhdHVyZSA8IFRFTVBFUkFUVVJFX0w0KQ0KICAgICAgICAgICAgICAgIHBvd2VyID0gIjIiOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHBvd2VyID0gIjMiOw0KDQogICAgICAgICAgICB0b3BpYyA9IENPTkRJVElPTkVSX1RPUElDDQogICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICJkb3duIg0KICAgICAgICB9DQoNCiAgICAgICAgLy8gZGV2byBhbHphcmUgbGEgdGVtcGVyYXR1cmENCiAgICAgICAgZWxzZSBpZiAodGVtcGVyYXR1cmUgPCBNSU5fVEVNUEVSQVRVUkUpIHsNCg0KICAgICAgICAgICAgaWYgKHRlbXBlcmF0dXJlID4gVEVNUEVSQVRVUkVfTDIpDQogICAgICAgICAgICAgICAgcG93ZXIgPSAiMSI7DQogICAgICAgICAgICBlbHNlIGlmICh0ZW1wZXJhdHVyZSA+IFRFTVBFUkFUVVJFX0wxKQ0KICAgICAgICAgICAgICAgIHBvd2VyID0gIjIiOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHBvd2VyID0gIjMiOw0KDQogICAgICAgICAgICB0b3BpYyA9IFRIRVJNT1NUQVRfVE9QSUMNCiAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gInVwIg0KICAgICAgICB9DQoNCiAgICAgICAgc2VuZF90b190d29fdG9waWNfbXF0dCh0b3BpYywgVEFCTEVUX1RPUElDLCBwb3dlciwgdGVtcGVyYXR1cmUsIGRlc2NyaXB0aW9uKTsNCiAgICAgICAgY29udGV4dC5jYWxsYmFjaygiZmVlZGJhY2sge3RlbXBlcmF0dXJlOiAiICsgdGVtcGVyYXR1cmUgKyAiLCBwb3dlcjogIiArIHBvd2VyICsgIiwgZGVzY3JpcHRpb246ICIgKyBkZXNjcmlwdGlvbiArICJ9IikNCg0KICAgIH0NCn0NCg==
    commands:
      - 'npm install mqtt'
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
