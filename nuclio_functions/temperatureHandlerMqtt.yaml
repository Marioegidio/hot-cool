metadata:
  name: acaso
  labels:
    nuclio.io/project-name: 259e10f4-56ab-4271-b8ff-a0209a7dec74
spec:
  handler: "main:handler"
  runtime: nodejs
  resources: {}
  image: "nuclio/processor-temperatureHandlerMqtt:latest"
  minReplicas: 1
  maxReplicas: 1
  targetCPU: 75
  triggers:
    aCaso:
      class: ""
      kind: mqtt
      url: "guest:guest@192.168.1.7:1883"
      attributes:
        subscriptions:
          - qos: 2
            topic: iot/sensors/temperature
  build:
    image: ""
    noCache: false
    offline: false
    dependencies: []
    runtimeAttributes:
      repositories: []
    functionSourceCode: dmFyIG1xdHQgPSByZXF1aXJlKCdtcXR0Jyk7DQoNCmNvbnN0IEZVTkNUSU9OX05BTUUgPSAidGVtcGVyYXR1cmVIYW5kbGVyTXF0dCI7DQpjb25zdCBJUCA9ICIxOTIuMTY4LjEuNyINCmNvbnN0IENPTkRJVElPTkVSX1RPUElDID0gImlvdC9kZXZpY2VzL2NvbmRpdGlvbmVyIg0KY29uc3QgVEhFUk1PU1RBVF9UT1BJQyA9ICJpb3QvZGV2aWNlcy90aGVybW9zdGF0Ig0KY29uc3QgVEFCTEVUX1RPUElDID0gImlvdC9kZXZpY2VzL3RhYmxldCINCg0KY29uc3QgTUFYX1RFTVBFUkFUVVJFID0gMjYNCmNvbnN0IE1JTl9URU1QRVJBVFVSRSA9IDIyDQpjb25zdCBURU1QRVJBVFVSRV9MMSA9IDUNCmNvbnN0IFRFTVBFUkFUVVJFX0wyID0gMTENCmNvbnN0IFRFTVBFUkFUVVJFX0wzID0gMzQNCmNvbnN0IFRFTVBFUkFUVVJFX0w0ID0gNDANCg0KdmFyIG9wdGlvbnMgPSB7DQogICAgaG9zdDogJ21xdHQ6Ly8xOTIuMTY4LjEuNycsDQogICAgY2xpZW50SWQ6ICdtcXR0anNfJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnN1YnN0cigyLCA4KSwNCiAgICB1c2VybmFtZTogJ2d1ZXN0JywNCiAgICBwYXNzd29yZDogJ2d1ZXN0JywNCn07DQoNCnZhciBwb3dlciA9ICIwIg0KdmFyIGRlc2NyaXB0aW9uID0gIm5vIg0KdmFyIHRlbXBlcmF0dXJlID0gMjUNCg0KYXN5bmMgZnVuY3Rpb24gc2VuZF9zaW5nbGVfYWN0aW9uX21xdHQodG9waWMsIHBvd2VyLCB0ZW1wZXJhdHVyZSwgZGVzY3JpcHRpb24pIHsNCiAgICB2YXIgY2xpZW50ID0gbXF0dC5jb25uZWN0KCJtcXR0Oi8vIiArIElQLCBvcHRpb25zKTsNCiAgICBjbGllbnQub24oJ2Nvbm5lY3QnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgIGNsaWVudC5wdWJsaXNoKHRvcGljLCB0ZW1wZXJhdHVyZSArICItIiArIHBvd2VyICsgIi0iICsgZGVzY3JpcHRpb24sIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGNsaWVudC5lbmQoKTsNCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQphc3luYyBmdW5jdGlvbiBzZW5kX2FjdGlvbl9tcXR0KHRvcGljMSwgdG9waWMyLCBwb3dlciwgdGVtcGVyYXR1cmUsIGRlc2NyaXB0aW9uKSB7DQogICAgdmFyIGNsaWVudCA9IG1xdHQuY29ubmVjdCgibXF0dDovLyIgKyBJUCwgb3B0aW9ucyk7DQogICAgY2xpZW50Lm9uKCdjb25uZWN0JywgZnVuY3Rpb24gKCkgew0KICAgICAgICBjbGllbnQucHVibGlzaCh0b3BpYzEsIHRlbXBlcmF0dXJlICsgIi0iICsgcG93ZXIgKyAiLSIgKyBkZXNjcmlwdGlvbiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgY2xpZW50LnB1Ymxpc2godG9waWMyLCB0ZW1wZXJhdHVyZSArICItIiArIHBvd2VyICsgIi0iICsgZGVzY3JpcHRpb24sIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjbGllbnQuZW5kKCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgfSk7DQp9DQoNCmZ1bmN0aW9uIGJpbjJzdHJpbmcoYXJyYXkpIHsNCiAgICB2YXIgcmVzdWx0ID0gIiI7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7ICsraSkgew0KICAgICAgICByZXN1bHQgKz0gKFN0cmluZy5mcm9tQ2hhckNvZGUoYXJyYXlbaV0pKTsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KZXhwb3J0cy5oYW5kbGVyID0gZnVuY3Rpb24gKGNvbnRleHQsIGV2ZW50KSB7DQogICAgdmFyIF9ldmVudCA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZXZlbnQpKTsNCiAgICB2YXIgX2RhdGEgPSBiaW4yc3RyaW5nKF9ldmVudC5ib2R5LmRhdGEpOw0KDQogICAgdmFyIHRlbXBlcmF0dXJlID0gTnVtYmVyKF9kYXRhKQ0KICAgIGlmIChfZGF0YS50cmltKCkgPT0gIiIpIHRlbXBlcmF0dXJlID0gTUFYX1RFTVBFUkFUVVJFDQoNCiAgICB2YXIgcG93ZXIgPSAiMCINCiAgICB2YXIgZGVzY3JpcHRpb24gPSAibm8iDQoNCiAgICBpZiAodGVtcGVyYXR1cmUgPD0gTUFYX1RFTVBFUkFUVVJFICYmIHRlbXBlcmF0dXJlID49IE1JTl9URU1QRVJBVFVSRSkgew0KICAgICAgICAvLyBub24gZGV2byBmYXJlIG51bGxhLCBhbCBtYXNzaW1vIHN0b3BwbyB0dXR0bw0KDQogICAgICAgIHBvd2VyID0gIjAiDQogICAgICAgIGRlc2NyaXB0aW9uID0gInN0b3AiDQoNCiAgICAgICAgc2VuZF9hY3Rpb25fbXF0dChDT05ESVRJT05FUl9UT1BJQywgVEhFUk1PU1RBVF9UT1BJQywgcG93ZXIsIHRlbXBlcmF0dXJlLCBkZXNjcmlwdGlvbik7DQogICAgICAgIHNlbmRfc2luZ2xlX2FjdGlvbl9tcXR0KFRBQkxFVF9UT1BJQywgcG93ZXIsIHRlbXBlcmF0dXJlLCBkZXNjcmlwdGlvbik7DQoNCiAgICAgICAgY29udGV4dC5jYWxsYmFjaygiZmVlZGJhY2sge3RlbXBlcmF0dXJlOiAiICsgdGVtcGVyYXR1cmUgKyAiLCBwb3dlcjogIiArIHBvd2VyICsgIiwgZGVzY3JpcHRpb246ICIgKyBkZXNjcmlwdGlvbiArICJ9IikNCg0KICAgIH0NCiAgICBlbHNlIHsNCg0KICAgICAgICAvLyBUT0RPOiBjYW1iaWFyZSBjb24gY29zdGFudGkgaSB2YWxvcmkgbnVtZXJpY2kNCiAgICAgICAgLy8gZGV2byBhYmJhc3NhcmUgbGEgdGVtcGVyYXR1cmEgICAgDQogICAgICAgIGlmICh0ZW1wZXJhdHVyZSA+IE1BWF9URU1QRVJBVFVSRSkgew0KICAgICAgICAgICAgaWYgKHRlbXBlcmF0dXJlIDwgVEVNUEVSQVRVUkVfTDMpDQogICAgICAgICAgICAgICAgcG93ZXIgPSAiMSI7DQogICAgICAgICAgICBlbHNlIGlmICh0ZW1wZXJhdHVyZSA8IFRFTVBFUkFUVVJFX0w0KQ0KICAgICAgICAgICAgICAgIHBvd2VyID0gIjIiOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHBvd2VyID0gIjMiOw0KDQogICAgICAgICAgICB0b3BpYyA9IENPTkRJVElPTkVSX1RPUElDDQogICAgICAgICAgICBkZXNjcmlwdGlvbiA9ICJkb3duIg0KICAgICAgICB9DQoNCiAgICAgICAgLy8gZGV2byBhbHphcmUgbGEgdGVtcGVyYXR1cmENCiAgICAgICAgZWxzZSBpZiAodGVtcGVyYXR1cmUgPCBNSU5fVEVNUEVSQVRVUkUpIHsNCiAgICAgICAgICAgIGlmICh0ZW1wZXJhdHVyZSA+IFRFTVBFUkFUVVJFX0wyKQ0KICAgICAgICAgICAgICAgIHBvd2VyID0gIjEiOw0KICAgICAgICAgICAgZWxzZSBpZiAodGVtcGVyYXR1cmUgPiBURU1QRVJBVFVSRV9MMSkNCiAgICAgICAgICAgICAgICBwb3dlciA9ICIyIjsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBwb3dlciA9ICIzIjsNCiAgICAgICAgICAgIHRvcGljID0gVEhFUk1PU1RBVF9UT1BJQw0KICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAidXAiDQogICAgICAgIH0NCg0KICAgICAgICBjb250ZXh0LmNhbGxiYWNrKCJmZWVkYmFjayB7dGVtcGVyYXR1cmU6ICIgKyB0ZW1wZXJhdHVyZSArICIsIHBvd2VyOiAiICsgcG93ZXIgKyAiLCBkZXNjcmlwdGlvbjogIiArIGRlc2NyaXB0aW9uICsgIn0iKQ0KDQogICAgICAgIHNlbmRfYWN0aW9uX21xdHQodG9waWMsIFRBQkxFVF9UT1BJQywgcG93ZXIsIHRlbXBlcmF0dXJlLCBkZXNjcmlwdGlvbik7DQogICAgICAgIC8vc2VuZF9hY3Rpb25fbXF0dChUQUJMRVRfVE9QSUMsIHBvd2VyLCB0ZW1wZXJhdHVyZSwgZGVzY3JpcHRpb24pOw0KDQogICAgfQ0KfQ0K
    commands:
      - 'npm install mqtt'
    codeEntryType: sourceCode
  platform: {}
  readinessTimeoutSeconds: 60
